<p></p>
<p></p>
<p></p>
<p>
<script type="module" src="https://unpkg.com/@justinribeiro/lite-youtube@1.3.0/lite-youtube.js"></script>
<script module="">
import(
// In development we import locally.
window.location.hostname === "localhost"
? "/dist/web/install-button.js"
: "https://unpkg.com/esp-web-tools@9.0.5/dist/web/install-button.js?module"
);
</script>
</p>
<h1 class="content"><img src="https://raw.githubusercontent.com/openUC2/openUC2.github.io/master/static/img/Artboard4%404x.png" width="105" height="121" alt="" />&nbsp; &nbsp;OpenUC2 ESP32 Flashing Tool</h1>
<div class="content">
<p></p>
<p>User-friendly tools to flash/upload the firmware for the openUC2 ESP32 device in the browser:</p>
<ul>
<li>Install &amp; update firmware</li>
<li>Connect device to the Wi-Fi network (work in progress)</li>
<li>Visit the device's hosted web interface (work in progress)</li>
<li>Access logs and send terminal commands (work in progress)</li>
</ul>
<h2 id="demo">Flash the Firmware</h2>
<p>This demo will install <a href="https://github.com/youseetoo/uc2-esp32/">UC2-ESP</a>. To get started, connect an ESP device to your computer and hit the button (we assume you installed the CH340 or CP2102 driver).</p>
<p><strong>Note: </strong>This is only available on Chrome or Microsoft Edge.&nbsp;</p>
<esp-web-install-button manifest="static/firmware_build/manifest.json"> <i slot="unsupported"> The demo is not available because your browser does not support Web Serial. Open this page in Google Chrome or Microsoft Edge instead<span class="not-supported-i hidden"> (but not on your iOS device)&lt;/span &gt;. </span></i> </esp-web-install-button>
<h3></h3>
<h3></h3>
<h3></h3>
<h3 id="improv">Configuring Wi-Fi</h3>
<p>ESP Web Tools supports the <a href="https://www.improv-wifi.com/serial">Improv Wi-Fi serial standard&lt;/a &gt;. This is an open standard to allow configuring Wi-Fi via the serial port. </a></p>
<p>If the firmware supports Improv, a user will be asked to connect the device to the network after installing the firmware. Once connected, the device can send the user to a URL to finish configuration. For example, this can be a link to the device's IP address where it serves a local UI.</p>
<p>At any time in the future a user can use ESP Web Tools to find the device link or to reconfigure the Wi-Fi settings without doing a reinstall.</p>
<p class="screenshot"><img src="static/screenshots/dashboard.png" alt="Screenshot showing ESP Web Tools dialog offering visting the device, adding it to Home Assistant, change Wi-Fi, show logs and console and reset data." /> <i>Screenshot showing the ESP Web Tools interface</i></p>
<h3 id="logs">Viewing logs &amp; sending commands</h3>
<p>ESP Web Tools allows users to open a serial console to see the logs and send commands.</p>
<p class="screenshot"><img src="static/screenshots/logs.png" alt="Screenshot showing ESP Web Tools dialog with a console showing ESPHome logs and a terminal prompt to sent commands." /> <i>Screenshot showing the ESP Web Tools logs &amp; console</i></p>
<h2 id="add-website">Adding ESP Web Tools to your website</h2>
<p>To add this to your own website, you need to include the ESP Web Tools JavaScript files on your website, create a manifest file and add the ESP Web Tools button HTML.</p>
<p><a href="https://github.com/balloob/squeezelite-esp32-install">Click here to see a full example.&lt;/a &gt; </a></p>
<p><b>Step 1:</b> Load ESP Web Tools JavaScript on your website by adding the following HTML snippet.</p>
<pre>&lt;script
type="module"
src="https://unpkg.com/esp-web-tools@9.0.5/dist/web/install-button.js?module"
&gt;&lt;/script&gt;&lt;/pre
&gt;</pre>
<p>(If you prefer to locally host the JavaScript, <a href="https://unpkg.com/browse/esp-web-tools/dist/web/">download it here&lt;/a &gt;) </a></p>
<p><b>Step 2:</b> Find a place on your page where you want the button to appear and include the following bit of HTML. Update the <code>manifest</code> attribute to point at your manifest file.</p>
<pre>&lt;esp-web-install-button
manifest="/static/firmware_build/manifest.json"
&gt;&lt;/esp-web-install-button&gt;&lt;/pre
&gt;</pre>
<p><b>Note:</b> ESP Web Tools requires that your website is served over <code>https://</code> to work. This is a Web Serial security requirement.</p>
<p>If your manifest or the firmware files are hosted on another server, make sure you configure <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">the CORS-headers&lt;/a &gt; such that your website is allowed to fetch those files by adding the header <code>Access-Control-Allow-Origin: https://domain-of-your-website.com&lt;/code
&gt;.
</code></a></p>
<p>ESP Web Tools can also be integrated in your projects by installing it <a href="https://www.npmjs.com/package/esp-web-tools">via NPM</a>.</p>
<h3 id="preparing-firmware">Preparing your firmware</h3>
<p>If you have ESP32 firmware and are using ESP-IDF framework v4 or later, you will need to create a merged version of your firmware before being able to use it with ESP Web Tools. If you use ESP8266 or ESP32 with ESP-IDF v3 or earlier, you can skip this section.</p>
<p>ESP32 firmware is split into 4 different files. When these files are installed using the command-line tool <code>esptool</code>, it will patch flash frequency, flash size and flash mode to match the target device. ESP Web Tools is not able to do this on the fly, so you will need to use <code>esptool</code> to create the single binary file and use that with ESP Web Tools.</p>
<p>Create a single binary using <code>esptool</code> with the following command:</p>
<pre>esptool --chip esp32 merge_bin \
-o merged-firmware.bin \
--flash_mode dio \
--flash_freq 40m \
--flash_size 4MB \
0x1000 bootloader.bin \
0x8000 partitions.bin \
0xe000 boot.bin \
0x10000 your_app.bin&lt;/pre
&gt;</pre>
<p>If your memory type is <code>opi_opi</code> or <code>opi_qspi</code>, set your flash mode to be <code>dout</code>. Else, if your flash mode is <code>qio</code> or <code>qout</code>, override your flash mode to be <code>dio</code>.</p>
<h3 id="manifest">Creating your manifest</h3>
<p>Manifests describe the firmware that you want to offer the user to install. It allows specifying different builds for the different types of ESP devices. Current supported chip families are <code>ESP8266</code>, <code>ESP32</code>, <code>ESP32-C3</code>, <code>ESP32-S2</code> and <code>ESP32-S3</code>. The correct build will be automatically selected based on the type of the connected ESP device.</p>
<pre>{
"name": "ESPHome",
"version": "2021.11.0",
"home_assistant_domain": "esphome",
"funding_url": "https://esphome.io/guides/supporters.html",
"new_install_prompt_erase": false,
"builds": [
{
"chipFamily": "ESP32",
"parts": [
{ "path": "merged-firmware.bin", "offset": 0 },
]
},
{
"chipFamily": "ESP8266",
"parts": [
{ "path": "esp8266.bin", "offset": 0 }
]
}
]
}&lt;/pre
&gt;</pre>
<p>Each build contains a list of parts to be installed to the ESP device. Each part consists of a path to the file and an offset on the flash where it should be installed. Part paths are resolved relative to the path of the manifest, but can also be URLs to other hosts.</p>
<p>If your firmware is supported by Home Assistant, you can add the optional key <code>home_assistant_domain</code>. If present, ESP Web Tools will link the user to add this device to Home Assistant.</p>
<p>By default a new installation will erase all data before installation. If you want to leave this choice to the user, set the optional manifest key <code>new_install_prompt_erase</code> to <code>true</code>. ESP Web Tools offers users a new installation if it is unable to detect the current firmware of the device (via Improv Serial) or if the detected firmware does not match the name specififed in the manifest.</p>
<p>When a firmware is first installed on a device, it might need to do some time consuming tasks like initializing the file system. By default ESP Web Tools will wait 10 seconds to receive an Improv Serial response to indicate that the boot is completed. You can increase this timeout by setting the optional manifest key <code>new_install_improv_wait_time</code> to the number of seconds to wait. Set to <code>0</code> to disable Improv Serial detection.</p>
<p>If your product accepts donations you can add <code>funding_url</code> to your manifest. This allows you to link to your page explaining the user how they can fund development. This link is visible in the ESP Web Tools menu when connected to a device running your firmware (as detected via Improv).</p>
<p>ESP Web Tools allows you to provide your own check if the device is running the same firmware as specified in the manifest. This check can be setting the <code>overrides</code> property on <code>&lt;esp-web-install-button&gt;</code>. The value is an object containing a <code>checkSameFirmware(manifest, improvInfo)</code> function. The <code>manifest</code> parameter is your manifest and <code>improvInfo</code> is the information returned from Improv: <code>{ name, firmware, version, chipFamily }</code>. This check is only called if the device firmware was detected via Improv.</p>
<pre>const button = document.querySelector('esp-web-install-button');
button.overrides = {
checkSameFirmware(manifest, improvInfo) {
const manifestFirmware = manifest.name.toLowerCase();
const deviceFirmware = improvInfo.firmware.toLowerCase();
return manifestFirmware.includes(deviceFirmware);
}
};&lt;/pre
&gt;</pre>
<h3 id="customize">Customizing the look and feel</h3>
<p>You can change the colors of the default UI elements with CSS custom properties (variables), the following variables are available:</p>
<ul>
<li><code>--esp-tools-button-color</code></li>
<li><code>--esp-tools-button-text-color</code></li>
</ul>
<p>There are also some attributes that can be used for styling:</p>
<table>
<tbody>
<tr>
<td><code>install-supported</code></td>
<td>Added if installing firmware is supported</td>
</tr>
<tr>
<td><code>install-unsupported</code></td>
<td>Added if installing firmware is not supported</td>
</tr>
</tbody>
</table>
<h4>Replace the button and message with a custom one</h4>
<p>You can replace both the activation button and the message that is shown when the user uses an unsupported browser or non-secure context with your own elements. This can be done using the <code>activate</code>, <code>unsupported</code> and <code>not-allowed</code> slots:</p>
<pre>&lt;esp-web-install-button
manifest="/static/firmware_build/manifest.json"
&gt;
&lt;button slot="activate"&gt;Custom install button&lt;/button&gt;
&lt;span slot="unsupported"&gt;Ah snap, your browser doesn't work!&lt;/span&gt;
&lt;span slot="not-allowed"&gt;Ah snap, you are not allowed to use this on HTTP!&lt;/span&gt;
&lt;/esp-web-install-button&gt;
&lt;/pre
&gt;</pre>
<h2>Why we created ESP Web Tools</h2>
<div class="videoWrapper"><lite-youtube videoid="6ZMXE5PXPqU" videotitle="Why we created ESP Web Tools" videostartat="1255"></lite-youtube></div>
<div class="footer">
<div class="initiative">ESP Web Tools is a project by <a href="https://esphome.io">ESPHome</a>.<br />Development is funded by <a href="https://www.nabucasa.com">Nabu Casa</a>.</div>
<div>ESP Web Tools is <a href="https://github.com/esphome/esp-web-tools">open source</a>.</div>
</div>
<pre></pre>
</div>
<p>
<script>
if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
document.querySelector(".not-supported-i").classList.remove("hidden");
}
</script>
</p>