<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>Narrow Jumbotron Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link href="editor.css" rel="stylesheet">
    <script src="../../../_libraries/serial.js"></script>

    <!-- Custom styles for this template -->
    <link href="jumbotron-narrow.css" rel="stylesheet">
</head>

<body data-new-gr-c-s-check-loaded="14.1093.0" data-gr-ext-installed="" data-new-gr-c-s-loaded="14.1093.0">

    <div class="container">
        <div class="header clearfix">
            <nav>
                <ul class="nav nav-pills float-right">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contact</a>
                    </li>
                </ul>
            </nav>
            <h3 class="text-muted">Project name</h3>
        </div>

        <div class="jumbotron">
            <h1 class="display-3">Try UC2 online</h1>
            <p class="lead">This is to use the Web Serial interface to control a UC2 ESP device</p>
            <p><a class="btn btn-lg btn-success" id="btn-connect" onclick="onButtonConnectToSerialDevice()" role="button">Connect to ESP32</a></p>
        </div>

        <div id="text-interface">
            <h3>Enter text:</h3>
            <input placeholder="Enter some text" name="input-text" />
      
            <h3>Display text:</h3>
            <p id="output-text"></p>
      
            <h3>Received from Arduino:</h3>
            <p id="received-text"></p>
          </div>

          
        <div class="row marketing">
            <div class="col-lg-6">
                <h4>LED Array</h4>
                <p><button type="button" onclick="ledOn()" class="btn btn-info" style=""> Primary </button></p>
                <p><button type="button" onclick="ledOff()" class="btn btn-warning" style="">Off</button></p>

                <h4>Motor X</h4>
                <p>Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Cras mattis consectetur purus sit amet
                    fermentum.</p>

                <h4>Subheading</h4>
                <p>Maecenas sed diam eget risus varius blandit sit amet non magna.</p>
            </div>


        </div>

        <footer class="footer">
            <p>Â© openUC2 2023</p>
        </footer>

    </div> <!-- /container -->

    <script>
        const inputText = document.querySelector('input');
        const outputText = document.getElementById('output-text');
        const rcvdText = document.getElementById('received-text');

        inputText.addEventListener('input', updateOutputText);

        function ledOn() {
            cmd='{"task":"/ledarr_act", "led":{"LEDArrMode":1, "led_array":[{"id":0, "r":255, "g":255, "b":255}]}}'
            serialWriteTextData(cmd);
        }

        function ledOff() {
            cmd='{"task":"/ledarr_act", "led":{"LEDArrMode":1, "led_array":[{"id":0, "r":0, "g":0, "b":0}]}}'
            serialWriteTextData(cmd);
        }

        function updateOutputText(e) {
            outputText.textContent = e.target.value;
            serialWriteTextData(e.target.value);
        }

        // Setup Web Serial using serial.js
        const serial = new Serial({ baudRate: 115200 });
        serial.on(SerialEvents.CONNECTION_OPENED, onSerialConnectionOpened);
        serial.on(SerialEvents.CONNECTION_CLOSED, onSerialConnectionClosed);
        serial.on(SerialEvents.DATA_RECEIVED, onSerialDataReceived);
        serial.on(SerialEvents.ERROR_OCCURRED, onSerialErrorOccurred);

        /**
         * Callback function for when the connect button is pressed
         */
        async function onButtonConnectToSerialDevice() {
            console.log("onButtonConnectToSerialDevice");
            if (!serial.isOpen()) {
                await serial.connectAndOpen();
            }
        }

        /**
         * Send data over serial
         */
        async function serialWriteTextData(textData) {

            if (serial.isOpen()) {
                console.log("Writing to serial: ", textData);
                serial.writeLine(textData);
            }
        }

        /**
         * Callback function by serial.js when there is an error on web serial
         * 
         * @param {} eventSender 
         */
        function onSerialErrorOccurred(eventSender, error) {
            console.log("onSerialErrorOccurred", error);
        }

        /**
         * Callback function by serial.js when web serial connection is opened
         * 
         * @param {} eventSender 
         */
        function onSerialConnectionOpened(eventSender) {
            console.log("onSerialConnectionOpened");
            document.getElementById("connect-button").style.display = "none";
            document.getElementById("text-interface").style.display = "block";
        }

        /**
         * Callback function by serial.js when web serial connection is closed
         * 
         * @param {} eventSender 
         */
        function onSerialConnectionClosed(eventSender) {
            console.log("onSerialConnectionClosed");
            document.getElementById("connect-button").style.display = "block";
            document.getElementById("text-interface").style.display = "none";
        }

        /**
         * Callback function serial.js when new web serial data is received
         * 
         * @param {*} eventSender 
         * @param {String} newData new data received over serial
         */
        function onSerialDataReceived(eventSender, newData) {
            console.log("onSerialDataReceived", newData);
            rcvdText.textContent = newData;
        }
    </script>

</body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration>

</html>
